import{c as v,Y as R,T as D,r as h,j as s,C as u,f as x,d as p,e as w,B as g}from"./index-DYty7JYV.js";import{a as T,B as Q,C as q}from"./badge-WupeXOH_.js";import{Q as A,C as j,A as b,b as S,a as B,E}from"./qrCodeService-D3mphzmC.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=v("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);class I{static async trackScan(r){try{const t=`qr_scan_${r.qrCodeId}_${Date.now()}`,e={...r,id:t,timestamp:r.timestamp.toISOString()};this.storeScanLocally(e),console.log("QR Code scanned:",e)}catch(t){console.error("Error tracking QR scan:",t)}}static async getAnalytics(r,t){try{return this.generateMockAnalytics(r,t)}catch(e){throw console.error("Error fetching analytics:",e),e}}static async getRealTimeScanCount(r){try{return Math.floor(Math.random()*100)+50}catch(t){return console.error("Error fetching real-time scan count:",t),0}}static async exportAnalytics(r,t="csv"){try{const e=await this.getAnalytics(r);switch(t){case"csv":return this.convertToCSV(e);case"json":return JSON.stringify(e,null,2);case"pdf":return this.convertToPDF(e);default:throw new Error("Unsupported export format")}}catch(e){throw console.error("Error exporting analytics:",e),e}}static async getScanTrends(r,t=30){try{const e=[],a=new Date;for(let c=t-1;c>=0;c--){const o=new Date(a);o.setDate(o.getDate()-c);const n=10+Math.sin(c/5)*5,i=Math.random()*10,l=Math.max(0,Math.round(n+i));e.push({date:o.toISOString().split("T")[0],scans:l})}return e}catch(e){throw console.error("Error fetching scan trends:",e),e}}static async getTopPerformingQRCodes(r=10){try{return[{id:"1",title:"Player Registration - Main",scans:1250,conversionRate:.85},{id:"2",title:"Tournament Info 2025",scans:890,conversionRate:.72},{id:"3",title:"Team Chennai Champions",scans:675,conversionRate:.91},{id:"4",title:"Prize Money Details",scans:543,conversionRate:.68},{id:"5",title:"Match Schedule",scans:432,conversionRate:.79}].slice(0,r)}catch(t){throw console.error("Error fetching top performing QR codes:",t),t}}static parseUserAgent(r){const t=r.toLowerCase(),e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t),a=/ipad|android(?=.*\btablet\b)|tablet/i.test(t),c=!e&&!a;let o="unknown";t.includes("chrome")?o="Chrome":t.includes("firefox")?o="Firefox":t.includes("safari")?o="Safari":t.includes("edge")?o="Edge":t.includes("opera")&&(o="Opera");let n="unknown";return t.includes("windows")?n="Windows":t.includes("mac os x")?n="macOS":t.includes("linux")?n="Linux":t.includes("android")?n="Android":(t.includes("ios")||t.includes("iphone")||t.includes("ipad"))&&(n="iOS"),{browser:o,os:n,isMobile:e,isTablet:a,isDesktop:c}}static storeScanLocally(r){try{const t=JSON.parse(localStorage.getItem("qr_scans")||"[]");t.push(r),t.length>1e3&&t.splice(0,t.length-1e3),localStorage.setItem("qr_scans",JSON.stringify(t))}catch(t){console.error("Error storing scan locally:",t)}}static generateMockAnalytics(r,t){const e=Math.floor(Math.random()*1e3)+100,a=Math.floor(e*.7),c=[],o=30;for(let i=o-1;i>=0;i--){const l=new Date;l.setDate(l.getDate()-i),c.push({date:l.toISOString().split("T")[0],scans:Math.floor(Math.random()*50)+10})}const n=[];for(let i=0;i<24;i++)n.push({hour:i,scans:Math.floor(Math.random()*20)+5});return{totalScans:e,uniqueVisitors:a,scansByDate:c,scansByHour:n,topReferrers:[{referrer:"Direct",scans:Math.floor(e*.4)},{referrer:"Facebook",scans:Math.floor(e*.25)},{referrer:"Instagram",scans:Math.floor(e*.2)},{referrer:"Twitter",scans:Math.floor(e*.15)}],deviceBreakdown:{mobile:Math.floor(e*.6),tablet:Math.floor(e*.2),desktop:Math.floor(e*.2)},browserBreakdown:[{browser:"Chrome",scans:Math.floor(e*.5)},{browser:"Safari",scans:Math.floor(e*.25)},{browser:"Firefox",scans:Math.floor(e*.15)},{browser:"Edge",scans:Math.floor(e*.1)}],osBreakdown:[{os:"Android",scans:Math.floor(e*.4)},{os:"iOS",scans:Math.floor(e*.35)},{os:"Windows",scans:Math.floor(e*.15)},{os:"macOS",scans:Math.floor(e*.1)}],locationBreakdown:[{location:"India",scans:Math.floor(e*.7)},{location:"UAE",scans:Math.floor(e*.15)},{location:"USA",scans:Math.floor(e*.1)},{location:"UK",scans:Math.floor(e*.05)}],conversionRate:Math.random()*.3+.7}}static convertToCSV(r){const t=["Metric","Value"],e=[["Total Scans",r.totalScans.toString()],["Unique Visitors",r.uniqueVisitors.toString()],["Conversion Rate",`${(r.conversionRate*100).toFixed(2)}%`],["",""],["Device Breakdown",""],["Mobile",r.deviceBreakdown.mobile.toString()],["Tablet",r.deviceBreakdown.tablet.toString()],["Desktop",r.deviceBreakdown.desktop.toString()],["",""],["Top Browsers",""],...r.browserBreakdown.map(a=>[a.browser,a.scans.toString()]),["",""],["Top Operating Systems",""],...r.osBreakdown.map(a=>[a.os,a.scans.toString()])];return[t,...e].map(a=>a.map(c=>`"${c}"`).join(",")).join(`
`)}static convertToPDF(r){return`PDF Report for QR Code Analytics

Total Scans: ${r.totalScans}
Unique Visitors: ${r.uniqueVisitors}
Conversion Rate: ${(r.conversionRate*100).toFixed(2)}%`}}const V=()=>{const[m]=R(),r=D(),[t,e]=h.useState(!0),[a,c]=h.useState(null),[o,n]=h.useState(null),[i,l]=h.useState(!1),f=m.get("code"),N=m.get("source")||"direct";h.useEffect(()=>{f?k(f):(n("No QR code provided"),e(!1))},[f]);const k=async M=>{try{e(!0);const d=await A.getQRCodeByCode(M);if(!d){n("QR code not found or expired"),e(!1);return}c(d),await I.trackScan({qrCodeId:d.id,timestamp:new Date,ipAddress:"",userAgent:navigator.userAgent,referrer:document.referrer,scanSource:N}),l(!0),setTimeout(()=>{window.location.href=d.targetUrl},3e3)}catch(d){console.error("Error processing QR scan:",d),n("Failed to process QR code")}finally{e(!1)}},C=()=>{a&&(window.location.href=a.targetUrl)};return t?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cricket-blue to-cricket-light-blue flex items-center justify-center p-4",children:s.jsx(u,{className:"w-full max-w-md",children:s.jsxs(x,{className:"flex flex-col items-center justify-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cricket-yellow mb-4"}),s.jsx("h2",{className:"text-xl font-semibold text-cricket-blue mb-2",children:"Processing QR Code"}),s.jsx("p",{className:"text-muted-foreground text-center",children:"Please wait while we redirect you..."})]})})}):o?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:s.jsxs(u,{className:"w-full max-w-md",children:[s.jsxs(p,{children:[s.jsx("div",{className:"flex items-center justify-center mb-4",children:s.jsx(j,{className:"h-12 w-12 text-red-500"})}),s.jsx(w,{className:"text-center text-red-700",children:"Invalid QR Code"})]}),s.jsxs(x,{className:"text-center",children:[s.jsxs(b,{className:"mb-4",children:[s.jsx(j,{className:"h-4 w-4"}),s.jsx(S,{children:o})]}),s.jsx(g,{onClick:()=>r("/"),className:"w-full",children:"Go to Homepage"})]})]})}):s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-green-100 flex items-center justify-center p-4",children:s.jsxs(u,{className:"w-full max-w-md",children:[s.jsxs(p,{children:[s.jsx("div",{className:"flex items-center justify-center mb-4",children:s.jsxs("div",{className:"relative",children:[s.jsx(T,{className:"h-12 w-12 text-green-500"}),i&&s.jsx("div",{className:"absolute -top-1 -right-1 h-4 w-4 bg-cricket-yellow rounded-full animate-pulse"})]})}),s.jsx(w,{className:"text-center text-green-700",children:"QR Code Scanned Successfully!"})]}),s.jsx(x,{className:"space-y-4",children:a&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"text-center",children:[s.jsxs(Q,{className:"bg-cricket-blue text-cricket-yellow mb-2",children:[s.jsx(B,{className:"w-3 h-3 mr-1"}),a.title]}),a.description&&s.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),s.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[s.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[s.jsxs("span",{className:"flex items-center",children:[s.jsx(E,{className:"w-4 h-4 mr-1"}),"Total Scans"]}),s.jsx("span",{className:"font-semibold",children:a.currentScans})]}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("span",{className:"flex items-center",children:[s.jsx(q,{className:"w-4 h-4 mr-1"}),"Created"]}),s.jsx("span",{children:new Date(a.createdAt).toLocaleDateString()})]})]}),s.jsxs(b,{children:[s.jsx(y,{className:"h-4 w-4"}),s.jsx(S,{children:"You will be redirected to the destination in 3 seconds..."})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(g,{onClick:C,className:"flex-1 bg-cricket-yellow text-cricket-blue hover:bg-yellow-400",children:[s.jsx(y,{className:"w-4 h-4 mr-2"}),"Go Now"]}),s.jsx(g,{variant:"outline",onClick:()=>r("/"),className:"flex-1",children:"Cancel"})]})]})})]})})};export{V as default};
