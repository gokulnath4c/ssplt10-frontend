import{X as R,U as C,x as h,R as t,q as u,G as x,K as p,Q as w,p as g,a as D}from"./index-DMvwbkLi.js";import{u as T,p as q,c as Q}from"./badge-WupeXOH_-oOUKVsyM.js";import{O as A,q as b,d as j,g as y,_ as B,Q as E}from"./qrCodeService-D3mphzmC-DEUnTT4S.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=D("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);class O{static async trackScan(r){try{const s=`qr_scan_${r.qrCodeId}_${Date.now()}`,e={...r,id:s,timestamp:r.timestamp.toISOString()};this.storeScanLocally(e),console.log("QR Code scanned:",e)}catch(s){console.error("Error tracking QR scan:",s)}}static async getAnalytics(r,s){try{return this.generateMockAnalytics(r,s)}catch(e){throw console.error("Error fetching analytics:",e),e}}static async getRealTimeScanCount(r){try{return Math.floor(Math.random()*100)+50}catch(s){return console.error("Error fetching real-time scan count:",s),0}}static async exportAnalytics(r,s="csv"){try{const e=await this.getAnalytics(r);switch(s){case"csv":return this.convertToCSV(e);case"json":return JSON.stringify(e,null,2);case"pdf":return this.convertToPDF(e);default:throw new Error("Unsupported export format")}}catch(e){throw console.error("Error exporting analytics:",e),e}}static async getScanTrends(r,s=30){try{const e=[],a=new Date;for(let c=s-1;c>=0;c--){const o=new Date(a);o.setDate(o.getDate()-c);const n=10+Math.sin(c/5)*5,i=Math.random()*10,l=Math.max(0,Math.round(n+i));e.push({date:o.toISOString().split("T")[0],scans:l})}return e}catch(e){throw console.error("Error fetching scan trends:",e),e}}static async getTopPerformingQRCodes(r=10){try{return[{id:"1",title:"Player Registration - Main",scans:1250,conversionRate:.85},{id:"2",title:"Tournament Info 2025",scans:890,conversionRate:.72},{id:"3",title:"Team Chennai Champions",scans:675,conversionRate:.91},{id:"4",title:"Prize Money Details",scans:543,conversionRate:.68},{id:"5",title:"Match Schedule",scans:432,conversionRate:.79}].slice(0,r)}catch(s){throw console.error("Error fetching top performing QR codes:",s),s}}static parseUserAgent(r){const s=r.toLowerCase(),e=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(s),a=/ipad|android(?=.*\btablet\b)|tablet/i.test(s),c=!e&&!a;let o="unknown";s.includes("chrome")?o="Chrome":s.includes("firefox")?o="Firefox":s.includes("safari")?o="Safari":s.includes("edge")?o="Edge":s.includes("opera")&&(o="Opera");let n="unknown";return s.includes("windows")?n="Windows":s.includes("mac os x")?n="macOS":s.includes("linux")?n="Linux":s.includes("android")?n="Android":(s.includes("ios")||s.includes("iphone")||s.includes("ipad"))&&(n="iOS"),{browser:o,os:n,isMobile:e,isTablet:a,isDesktop:c}}static storeScanLocally(r){try{const s=JSON.parse(localStorage.getItem("qr_scans")||"[]");s.push(r),s.length>1e3&&s.splice(0,s.length-1e3),localStorage.setItem("qr_scans",JSON.stringify(s))}catch(s){console.error("Error storing scan locally:",s)}}static generateMockAnalytics(r,s){const e=Math.floor(Math.random()*1e3)+100,a=Math.floor(e*.7),c=[],o=30;for(let i=o-1;i>=0;i--){const l=new Date;l.setDate(l.getDate()-i),c.push({date:l.toISOString().split("T")[0],scans:Math.floor(Math.random()*50)+10})}const n=[];for(let i=0;i<24;i++)n.push({hour:i,scans:Math.floor(Math.random()*20)+5});return{totalScans:e,uniqueVisitors:a,scansByDate:c,scansByHour:n,topReferrers:[{referrer:"Direct",scans:Math.floor(e*.4)},{referrer:"Facebook",scans:Math.floor(e*.25)},{referrer:"Instagram",scans:Math.floor(e*.2)},{referrer:"Twitter",scans:Math.floor(e*.15)}],deviceBreakdown:{mobile:Math.floor(e*.6),tablet:Math.floor(e*.2),desktop:Math.floor(e*.2)},browserBreakdown:[{browser:"Chrome",scans:Math.floor(e*.5)},{browser:"Safari",scans:Math.floor(e*.25)},{browser:"Firefox",scans:Math.floor(e*.15)},{browser:"Edge",scans:Math.floor(e*.1)}],osBreakdown:[{os:"Android",scans:Math.floor(e*.4)},{os:"iOS",scans:Math.floor(e*.35)},{os:"Windows",scans:Math.floor(e*.15)},{os:"macOS",scans:Math.floor(e*.1)}],locationBreakdown:[{location:"India",scans:Math.floor(e*.7)},{location:"UAE",scans:Math.floor(e*.15)},{location:"USA",scans:Math.floor(e*.1)},{location:"UK",scans:Math.floor(e*.05)}],conversionRate:Math.random()*.3+.7}}static convertToCSV(r){const s=["Metric","Value"],e=[["Total Scans",r.totalScans.toString()],["Unique Visitors",r.uniqueVisitors.toString()],["Conversion Rate",`${(r.conversionRate*100).toFixed(2)}%`],["",""],["Device Breakdown",""],["Mobile",r.deviceBreakdown.mobile.toString()],["Tablet",r.deviceBreakdown.tablet.toString()],["Desktop",r.deviceBreakdown.desktop.toString()],["",""],["Top Browsers",""],...r.browserBreakdown.map(a=>[a.browser,a.scans.toString()]),["",""],["Top Operating Systems",""],...r.osBreakdown.map(a=>[a.os,a.scans.toString()])];return[s,...e].map(a=>a.map(c=>`"${c}"`).join(",")).join(`
`)}static convertToPDF(r){return`PDF Report for QR Code Analytics

Total Scans: ${r.totalScans}
Unique Visitors: ${r.uniqueVisitors}
Conversion Rate: ${(r.conversionRate*100).toFixed(2)}%`}}const V=()=>{const[m]=R(),r=C(),[s,e]=h.useState(!0),[a,c]=h.useState(null),[o,n]=h.useState(null),[i,l]=h.useState(!1),f=m.get("code"),N=m.get("source")||"direct";h.useEffect(()=>{f?M(f):(n("No QR code provided"),e(!1))},[f]);const M=async k=>{try{e(!0);const d=await A.getQRCodeByCode(k);if(!d){n("QR code not found or expired"),e(!1);return}c(d),await O.trackScan({qrCodeId:d.id,timestamp:new Date,ipAddress:"",userAgent:navigator.userAgent,referrer:document.referrer,scanSource:N}),l(!0),setTimeout(()=>{window.location.href=d.targetUrl},3e3)}catch(d){console.error("Error processing QR scan:",d),n("Failed to process QR code")}finally{e(!1)}},v=()=>{a&&(window.location.href=a.targetUrl)};return s?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-cricket-blue to-cricket-light-blue flex items-center justify-center p-4",children:t.jsx(u,{className:"w-full max-w-md",children:t.jsxs(x,{className:"flex flex-col items-center justify-center py-12",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cricket-yellow mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-cricket-blue mb-2",children:"Processing QR Code"}),t.jsx("p",{className:"text-muted-foreground text-center",children:"Please wait while we redirect you..."})]})})}):o?t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center p-4",children:t.jsxs(u,{className:"w-full max-w-md",children:[t.jsxs(p,{children:[t.jsx("div",{className:"flex items-center justify-center mb-4",children:t.jsx(b,{className:"h-12 w-12 text-red-500"})}),t.jsx(w,{className:"text-center text-red-700",children:"Invalid QR Code"})]}),t.jsxs(x,{className:"text-center",children:[t.jsxs(j,{className:"mb-4",children:[t.jsx(b,{className:"h-4 w-4"}),t.jsx(y,{children:o})]}),t.jsx(g,{onClick:()=>r("/"),className:"w-full",children:"Go to Homepage"})]})]})}):t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-green-100 flex items-center justify-center p-4",children:t.jsxs(u,{className:"w-full max-w-md",children:[t.jsxs(p,{children:[t.jsx("div",{className:"flex items-center justify-center mb-4",children:t.jsxs("div",{className:"relative",children:[t.jsx(T,{className:"h-12 w-12 text-green-500"}),i&&t.jsx("div",{className:"absolute -top-1 -right-1 h-4 w-4 bg-cricket-yellow rounded-full animate-pulse"})]})}),t.jsx(w,{className:"text-center text-green-700",children:"QR Code Scanned Successfully!"})]}),t.jsx(x,{className:"space-y-4",children:a&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-center",children:[t.jsxs(q,{className:"bg-cricket-blue text-cricket-yellow mb-2",children:[t.jsx(B,{className:"w-3 h-3 mr-1"}),a.title]}),a.description&&t.jsx("p",{className:"text-sm text-muted-foreground",children:a.description})]}),t.jsxs("div",{className:"bg-muted p-3 rounded-lg",children:[t.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx(E,{className:"w-4 h-4 mr-1"}),"Total Scans"]}),t.jsx("span",{className:"font-semibold",children:a.currentScans})]}),t.jsxs("div",{className:"flex items-center justify-between text-sm",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx(Q,{className:"w-4 h-4 mr-1"}),"Created"]}),t.jsx("span",{children:new Date(a.createdAt).toLocaleDateString()})]})]}),t.jsxs(j,{children:[t.jsx(S,{className:"h-4 w-4"}),t.jsx(y,{children:"You will be redirected to the destination in 3 seconds..."})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(g,{onClick:v,className:"flex-1 bg-cricket-yellow text-cricket-blue hover:bg-yellow-400",children:[t.jsx(S,{className:"w-4 h-4 mr-2"}),"Go Now"]}),t.jsx(g,{variant:"outline",onClick:()=>r("/"),className:"flex-1",children:"Cancel"})]})]})})]})})};export{V as default};
