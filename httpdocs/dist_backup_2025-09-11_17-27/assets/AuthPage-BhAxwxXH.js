import{u as A,r as m,T as R,g as I,j as e,C as E,d as P,e as T,U as L,f as D,B as U}from"./index-ClbRxmS6.js";import{S as M,I as p}from"./input-aOiFhBBR.js";import{L as f}from"./label-CIKsM4xr.js";const B=()=>{const{user:s,signIn:j,loading:n,roleLoading:o,userRole:t,checkUserRoleInDB:w,setUserAsAdmin:y,makeGokulnathAdmin:b}=A(),[d,u]=m.useState({email:"",password:""}),[g,h]=m.useState(!1),l=R(),{toast:k}=I(),N=async()=>{s?.id&&(console.log("Manual role fetch test triggered for user:",s.id),console.log("Current auth state:",{user:s,loading:n,roleLoading:o,userRole:t}))},v=async()=>{if(s?.email==="gokulnath.4c@gmail.com"){console.log("ðŸ” Checking role for gokulnath.4c@gmail.com...");const a=await w("gokulnath.4c@gmail.com");console.log("ðŸ” Role for gokulnath.4c@gmail.com:",a),a==="admin"?(console.log("âœ… gokulnath.4c@gmail.com is confirmed as admin"),window.location.reload()):(console.log("âŒ gokulnath.4c@gmail.com is not admin, attempting to set..."),await y("gokulnath.4c@gmail.com")&&(console.log("âœ… Successfully set gokulnath.4c@gmail.com as admin"),window.location.reload()))}else console.log("Current user is not gokulnath.4c@gmail.com")},x=async()=>{if(s?.email==="gokulnath.4c@gmail.com"){console.log("ðŸ”§ Making gokulnath.4c@gmail.com admin...");const a=await b();console.log(a?"âœ… gokulnath.4c@gmail.com is now admin!":"âŒ Failed to make gokulnath.4c@gmail.com admin")}else console.log("Current user is not gokulnath.4c@gmail.com")};m.useEffect(()=>{console.log("AuthPage state changed:",{user:s?.id,loading:n,roleLoading:o,userRole:t,timestamp:new Date().toISOString()})},[s,n,o,t]),m.useEffect(()=>{console.log("AuthPage useEffect - user:",s,"loading:",n,"roleLoading:",o,"userRole:",t),s&&!n&&!o&&t!==null&&(console.log("Redirecting user with role:",t),t==="admin"?(console.log("Redirecting admin user to /admin"),l("/admin")):(console.log("Redirecting regular user to /"),l("/"))),s&&!n&&o&&console.log("User authenticated, waiting for role...")},[s,t,n,o,l]),m.useEffect(()=>{if(s&&!n&&o){const a=setTimeout(()=>{console.log("Role fetching timeout - forcing redirection with default role"),t===null&&(console.log("Assuming user role and redirecting to home"),l("/"))},15e3);return()=>clearTimeout(a)}},[s,n,o,t,l]);const S=async a=>{a.preventDefault(),h(!0),console.log("Attempting sign in with:",{email:d.email,hasPassword:!!d.password});const{error:i}=await j(d.email,d.password);if(i){console.error("Sign in error:",i),console.error("Error details:",{message:i.message,status:i.status});let r="Sign In Failed",c="Please try again or contact support";i.message?.includes("Invalid login credentials")?(r="Invalid Credentials",c="The email or password you entered is incorrect. Please check and try again."):i.message?.includes("Email not confirmed")?(r="Email Not Verified",c="Please check your email and click the verification link before signing in."):i.message?.includes("Too many requests")?(r="Too Many Attempts",c="Too many sign-in attempts. Please wait a few minutes before trying again."):i.status===400?(r="Authentication Error",c="There was an issue with the authentication service. Please try again."):i.message?.includes("Network")&&(r="Connection Error",c="Network connection issue. Please check your internet connection."),console.log("Showing error toast:",{title:r,description:c}),k({title:r,description:c,variant:"destructive"})}else console.log("Sign in successful, waiting for role fetch and redirect");h(!1)};if(n||o)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-lg",children:n?"Authenticating...":"Loading user role..."})]})});const C=e.jsxs("div",{className:"mt-4 p-3 bg-gray-100 rounded text-xs text-gray-600",children:[e.jsx("p",{children:e.jsx("strong",{children:"Debug Info:"})}),e.jsxs("p",{children:["User: ",s?"Yes":"No"]}),e.jsxs("p",{children:["Loading: ",n?"Yes":"No"]}),e.jsxs("p",{children:["Role Loading: ",o?"Yes":"No"]}),e.jsxs("p",{children:["User Role: ",t||"Not set"]}),e.jsxs("p",{children:["User ID: ",s?.id||"N/A"]}),s&&t&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"Manual Redirection:"})}),e.jsx("button",{onClick:()=>l("/admin"),className:"px-2 py-1 bg-blue-500 text-white rounded text-xs mr-2",children:"Go to Admin Panel"}),e.jsx("button",{onClick:()=>l("/"),className:"px-2 py-1 bg-green-500 text-white rounded text-xs",children:"Go to Home"})]}),s&&!t&&e.jsx("div",{className:"mt-2",children:e.jsx("button",{onClick:N,className:"px-2 py-1 bg-yellow-500 text-white rounded text-xs",children:"Test Role Fetch"})}),s?.email==="gokulnath.4c@gmail.com"&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("p",{children:e.jsx("strong",{children:"ðŸ” Special Debug for gokulnath.4c@gmail.com:"})}),e.jsx("button",{onClick:v,className:"px-2 py-1 bg-purple-500 text-white rounded text-xs mr-2",children:"Check Role"}),e.jsx("button",{onClick:x,className:"px-2 py-1 bg-red-500 text-white rounded text-xs",children:"Set as Admin"}),e.jsxs("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded",children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-2",children:"ðŸš¨ Make gokulnath.4c@gmail.com Admin"}),e.jsx("button",{onClick:x,className:"w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-medium",children:"ðŸ”§ Make Me Admin Now!"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"This will set your role to 'admin' in the database"})]})]})]});return e.jsx("div",{className:"min-h-screen bg-cricket-light-blue flex items-center justify-center p-4",children:e.jsxs(E,{className:"w-full max-w-md shadow-elegant",children:[e.jsxs(P,{className:"bg-gradient-primary text-white rounded-t-lg text-center",children:[e.jsxs(T,{className:"flex items-center justify-center gap-2 text-2xl",children:[e.jsx(M,{className:"w-6 h-6 text-cricket-yellow"}),"SSPL Authentication"]}),e.jsx(L,{className:"text-cricket-yellow",children:"Access your SSPL account"})]}),e.jsxs(D,{className:"p-6",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"signin-email",children:"Email"}),e.jsx(p,{id:"signin-email",type:"email",value:d.email,onChange:a=>u(i=>({...i,email:a.target.value})),placeholder:"Enter your email",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"signin-password",children:"Password"}),e.jsx(p,{id:"signin-password",type:"password",value:d.password,onChange:a=>u(i=>({...i,password:a.target.value})),placeholder:"Enter your password",required:!0})]}),e.jsx(U,{type:"submit",className:"w-full bg-cricket-blue hover:bg-cricket-dark-blue",disabled:g,children:g?"Signing In...":"Sign In"})]})}),e.jsxs("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:[e.jsx("p",{children:"User accounts are created by administrators"}),e.jsx("p",{className:"mt-1",children:"Contact an administrator for account access"}),!1]}),s&&!n&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800",children:o?e.jsx("p",{children:"âœ… Signed in successfully! Loading your user role..."}):t?e.jsxs("p",{children:["âœ… Signed in successfully! Role: ",t]}):e.jsx("p",{children:"âœ… Signed in successfully! Determining your access level..."})}),C]})]})})};export{B as default};
